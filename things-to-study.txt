#!/bin/bash

# Fetch error counts
RENDERING_ERROR=$(kubectl get rootsync root-syn -n config-management-system -o jsonpath='{.status.rendering.errorSummary.errorCount}')
SOURCE_ERROR=$(kubectl get rootsync root-syn -n config-management-system -o jsonpath='{.status.source.errorSummary.errorCount}')
SYNC_ERROR=$(kubectl get rootsync root-syn -n config-management-system -o jsonpath='{.status.sync.errorSummary.errorCount}')

# Initialize email variables
EMAIL="your_email@example.com"
SUBJECT="Error Notification for RootSync"
BODY=""

# Check error counts and construct email body
if [ "$RENDERING_ERROR" -ge 1 ]; then
  BODY+="Rendering Error Count: $RENDERING_ERROR\n"
fi

if [ "$SOURCE_ERROR" -ge 1 ]; then
  BODY+="Source Error Count: $SOURCE_ERROR\n"
fi

if [ "$SYNC_ERROR" -ge 1 ]; then
  BODY+="Sync Error Count: $SYNC_ERROR\n"
fi

# Send email if there are any errors
if [ -n "$BODY" ]; then
  echo -e "$BODY" | mail -s "$SUBJECT" "$EMAIL"
fi
